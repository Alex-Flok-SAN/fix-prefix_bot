#!/usr/bin/env python3
"""
–ú–µ–Ω–µ–¥–∂–µ—Ä –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π FPF Bot
–ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∏ –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å GitHub
"""

from pathlib import Path
from datetime import datetime
import subprocess

class KnowledgeManager:
    """–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞–º–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π"""
    
    def __init__(self):
        self.baza_path = Path("/Users/sashaflok/fpf_bot/baza")
        self.sections = {
            "pattern": "01_fpf_pattern.txt",
            "philosophy": "02_philosophy.txt", 
            "architecture": "03_architecture.txt",
            "stream": "04_stream_core.txt",
            "levels": "05_level_engine.txt",
            "detector": "06_fpf_detector.txt",
            "filters": "07_context_filters.txt",
            "signals": "08_signal_manager.txt",
            "ui": "09_ui_system.txt",
            "backtest": "10_backtest.txt",
            "ml": "11_machine_learning.txt",
            "monitoring": "12_monitoring.txt",
            "integrations": "13_integrations.txt",
            "deployment": "14_deployment.txt",
            "requirements": "15_technical_requirements.txt",
            "roadmap": "16_development_plan.txt",
            "issues": "17_technical_issues.txt"
        }
        
    def update_section(self, section_key, content, description=None):
        """–û–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–∞–∑–¥–µ–ª –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π"""
        if section_key not in self.sections:
            print(f"‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–∞–∑–¥–µ–ª: {section_key}")
            print(f"üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã: {', '.join(self.sections.keys())}")
            return False
            
        file_path = self.baza_path / self.sections[section_key]
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        update_header = f"# –û–±–Ω–æ–≤–ª–µ–Ω–æ: {timestamp}\n"
        if description:
            update_header += f"# –ò–∑–º–µ–Ω–µ–Ω–∏—è: {description}\n"
        update_header += "\n"
        
        # –ß–∏—Ç–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
        if file_path.exists():
            existing_content = file_path.read_text()
            
            # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (–ª–∏–±–æ –∑–∞–º–µ–Ω—è–µ–º, –ª–∏–±–æ –¥–æ–ø–æ–ª–Ω—è–µ–º)
            if content.startswith("REPLACE:"):
                # –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞
                new_content = update_header + content[8:].strip()
            else:
                # –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ –∫–æ–Ω–µ—Ü
                new_content = existing_content.rstrip() + f"\n\n{update_header}{content}"
        else:
            # –ù–æ–≤—ã–π —Ñ–∞–π–ª
            new_content = update_header + content
            
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º
        file_path.write_text(new_content)
        print(f"‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª: {section_key} ({self.sections[section_key]})")
        
        return True
        
    def add_universal_fpf_info(self):
        """–î–æ–±–∞–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç–∏ FPF –ø–∞—Ç—Ç–µ—Ä–Ω–∞"""
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª –ø–∞—Ç—Ç–µ—Ä–Ω–∞
        universal_pattern_info = """
## –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–û–°–¢–¨ FPF –ü–ê–¢–¢–ï–†–ù–ê

**–í–ê–ñ–ù–û**: FPF (Fix-Prefix-Fix) - —ç—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ä–∞–∑–≤–æ—Ä–æ—Ç–Ω–∞—è –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã:

### –õ–û–ù–ì–û–í–´–ï FPF –ú–û–î–ï–õ–ò

#### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –õ–û–ù–ì–û–í–û–ì–û FIX-PREFIX:

1. **FIX –û–ë–õ–ê–°–¢–¨ (–ü–õ–ê–¢–û FIX)** - –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –¥–Ω–µ
   - –¶–µ–Ω–∞ –∏–∑ —Ñ–ª—ç—Ç–∞ –∏–¥–µ—Ç –≤–Ω–∏–∑
   - –û–±—Ä–∞–∑—É–µ—Ç –¥–Ω–æ - –ü–õ–ê–¢–û FIX (–æ–±–ª–∞—Å—Ç—å –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ –¥–Ω–µ)
   - –≠—Ç–æ –∑–æ–Ω–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è Smart Money –¥–ª—è –±—É–¥—É—â–∏—Ö –ø–æ–∫—É–ø–æ–∫

2. **–í–´–•–û–î –í–í–ï–†–• –ò–ó FIX**
   - –ü–æ—Å–ª–µ FIX —Ü–µ–Ω–∞ –≤—ã—Ö–æ–¥–∏—Ç –≤–≤–µ—Ä—Ö
   - –ò–¥–µ—Ç –∫–∞–∫–æ–µ-—Ç–æ –≤—Ä–µ–º—è –≤–≤–µ—Ä—Ö, –æ–±—Ä–∞–∑—É—è HI-FIX
   - HI-FIX = —Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π HIGH –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ FIX –æ–±–ª–∞—Å—Ç–∏

3. **–í–û–ó–í–†–ê–¢ –ù–ò–ñ–ï FIX**
   - –¶–µ–Ω–∞ –∏–¥–µ—Ç –≤–Ω–∏–∑ –Ω–∏–∂–µ –æ–±–ª–∞—Å—Ç–∏ FIX
   - –ö–∞–∫ —Ç–æ–ª—å–∫–æ —Ü–µ–Ω–∞ –ø—Ä–æ—à–ª–∞ –Ω–∏–∂–µ FIX, —Ñ–∏–∫—Å–∏—Ä—É–µ–º HI-FIX
   - HI-FIX = —Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π —Ö–∞–π –º–µ–∂–¥—É –æ–±–ª–∞—Å—Ç—å—é FIX –∏ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω–æ–π

4. **LOW-PATTERN (–î–û–ù–ù–ê–Ø –¢–û–ß–ö–ê)**
   - –¶–µ–Ω–∞ –∏–¥–µ—Ç –µ—â–µ –Ω–∏–∂–µ (–≤—ã—Å–æ—Ç–∞ –ø–∞–¥–µ–Ω–∏—è –≤–∞—Ä—å–∏—Ä—É–µ—Ç—Å—è)
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç Low-pattern (–¥–Ω–æ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞)
   - –ü–æ—Å–ª–µ Low-pattern —Ü–µ–Ω–∞ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤–≤–µ—Ä—Ö

5. **RAY (–õ–£–ß –í–ê–õ–ò–î–ê–¶–ò–ò)**
   - –ö–∞–∫ —Ç–æ–ª—å–∫–æ —Ü–µ–Ω–∞ –æ—Ç Low-pattern –ø–æ—à–ª–∞ –≤–≤–µ—Ä—Ö, —Ä–∏—Å—É–µ–º RAY –≤–ø—Ä–∞–≤–æ –æ—Ç HI-FIX
   - RAY = –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è –æ—Ç —Å–∞–º–æ–≥–æ –≤—ã—Å–æ–∫–æ–≥–æ —Ö–∞—è –º–µ–∂–¥—É FIX –∏ Low-pattern

6. **–í–ê–õ–ò–î–ê–¶–ò–Ø –ü–ê–¢–¢–ï–†–ù–ê**
   - –¶–µ–Ω–∞ –∏–¥–µ—Ç –≤—ã—à–µ, –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≤—ã—Å–æ—Ç–µ –æ–±–ª–∞—Å—Ç—å FIX
   - **–ö–ê–ö –¢–û–õ–¨–ö–û –¶–ï–ù–ê –ü–†–û–ô–î–ï–¢ –°–ù–ò–ó–£-–í–í–ï–†–• –£–†–û–í–ï–ù–¨ RAY –•–û–¢–Ø –ë–´ –ù–ê 1-2 –¢–ò–ö–ê**
   - **–¢–û–ì–î–ê –ü–ê–¢–¢–ï–†–ù –í–ê–õ–ò–î–ò–†–£–ï–¢–°–Ø –ò –û–ü–†–ï–î–ï–õ–Ø–ï–¢–°–Ø –û–ë–õ–ê–°–¢–¨ PREFIX**

7. **PREFIX –û–ë–õ–ê–°–¢–¨ (–¶–ï–õ–ï–í–ê–Ø –ó–û–ù–ê)**
   - PREFIX –ø–æ –≤—ã—Å–æ—Ç–µ —Ä–∞–≤–µ–Ω –æ–±–ª–∞—Å—Ç–∏ FIX
   - PREFIX = –Ω–∞—à–∞ —Ü–µ–ª–µ–≤–∞—è –æ–±–ª–∞—Å—Ç—å –¥–ª—è –ª–∏–º–∏—Ç–Ω–∏–∫–æ–≤ –≤ –õ–û–ù–ì
   - –¶–µ–Ω–∞ —á–∞—â–µ –∏–¥–µ—Ç –≤—ã—à–µ HI-FIX –ø–µ—Ä–µ–¥ –∑–∞—Ö–æ–¥–æ–º –≤ PREFIX

### –¢–û–†–ì–û–í–ê–Ø –õ–û–ì–ò–ö–ê –õ–û–ù–ì–û–í–´–• –ú–û–î–ï–õ–ï–ô:
- **–í—Ö–æ–¥:** –õ–∏–º–∏—Ç–Ω–∏–∫–∏ –≤ –æ–±–ª–∞—Å—Ç–∏ PREFIX (–ª–æ–Ω–≥)
- **–°—Ç–æ–ø:** –ù–∏–∂–µ PREFIX –æ–±–ª–∞—Å—Ç–∏
- **–ß–∞—Å—Ç–∏—á–Ω–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è:** BA75 (75% –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ)
- **–ü–æ–ª–Ω–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è:** –£—Ä–æ–≤–µ–Ω—å –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏—è –æ—Ç FIX

### –¢–ï–ö–£–©–ò–ô –§–û–ö–£–° –†–ê–ó–†–ê–ë–û–¢–ö–ò
–ù–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ —Å–∏—Å—Ç–µ–º–∞ —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ **–®–û–†–¢–û–í–´–• –º–æ–¥–µ–ª—è—Ö** –¥–ª—è –æ—Ç—Ä–∞–±–æ—Ç–∫–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –¥–µ—Ç–µ–∫—Ü–∏–∏, –Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏.
"""

        self.update_section("pattern", universal_pattern_info, "–î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–æ–Ω–≥–æ–≤—ã—Ö FPF –º–æ–¥–µ–ª—è—Ö")
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∏–ª–æ—Å–æ—Ñ–∏—é
        philosophy_update = """
## –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–û–°–¢–¨ –¢–û–†–ì–û–í–û–ì–û –ò–ù–¢–ï–õ–õ–ï–ö–¢–ê

–°–∏—Å—Ç–µ–º–∞ FPF Bot —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–∞–∫ **–¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç**:

### –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ –ö –†–´–ù–û–ß–ù–´–ú –¶–ò–ö–õ–ê–ú
- **Bull Market**: –§–æ–∫—É—Å –Ω–∞ –ª–æ–Ω–≥–æ–≤—ã–µ FPF –º–æ–¥–µ–ª–∏, —à–æ—Ä—Ç—ã —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è—Ö
- **Bear Market**: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —à–æ—Ä—Ç–æ–≤—ã–º –º–æ–¥–µ–ª—è–º, –ª–æ–Ω–≥–∏ –≤ –∑–æ–Ω–∞—Ö –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç–∏  
- **Sideways Market**: –†–∞–≤–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –æ–±–µ–∏–º –º–æ–¥–µ–ª—è–º

### –ü–°–ò–•–û–õ–û–ì–ò–Ø –î–í–£–ù–ê–ü–†–ê–í–õ–ï–ù–ù–û–ô –¢–û–†–ì–û–í–õ–ò

#### Smart Money –≤ –ª–æ–Ω–≥–æ–≤—ã—Ö —Ü–∏–∫–ª–∞—Ö:
- –ù–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç –∞–∫—Ç–∏–≤—ã –Ω–∞ –¥–æ–Ω—ã—à–∫–∞—Ö (FIX –æ–±–ª–∞—Å—Ç–∏)
- –°–æ–∑–¥–∞—é—Ç –ª–æ–∂–Ω—ã–µ –ø—Ä–æ–±–æ–∏ –≤–Ω–∏–∑ –¥–ª—è —Å–±–æ—Ä–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç retail –ø–∞–Ω–∏–∫—É –¥–ª—è –ª—É—á—à–∏—Ö –≤—Ö–æ–¥–æ–≤

#### Smart Money –≤ —à–æ—Ä—Ç–æ–≤—ã—Ö —Ü–∏–∫–ª–∞—Ö:
- –†–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –≤–µ—Ä—à–∏–Ω–∞—Ö (FIX –æ–±–ª–∞—Å—Ç–∏)
- –°–æ–∑–¥–∞—é—Ç –ª–æ–∂–Ω—ã–µ –ø—Ä–æ–±–æ–∏ –≤–≤–µ—Ä—Ö –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è retail
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç FOMO –¥–ª—è –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–¥–∞–∂

### –≠–í–û–õ–Æ–¶–ò–Ø –ö –ü–û–õ–ù–û–ô –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–û–°–¢–ò
–¢–µ–∫—É—â–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —à–æ—Ä—Ç–æ–≤—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ - —ç—Ç–æ **–ø–µ—Ä–≤—ã–π —ç—Ç–∞–ø** —Å–æ–∑–¥–∞–Ω–∏—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç:
1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ä—ã–Ω–æ—á–Ω—ã–π —Ü–∏–∫–ª
2. –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –ª–æ–Ω–≥/—à–æ—Ä—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏  
3. –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥ —Ç–µ–∫—É—â–∏–µ —É—Å–ª–æ–≤–∏—è
"""

        self.update_section("philosophy", philosophy_update, "–†–∞—Å—à–∏—Ä–µ–Ω–∞ —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è –¥–ª—è –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏")
        
    def create_architecture_file(self):
        """–°–æ–∑–¥–∞–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã"""
        
        architecture_content = """# –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –°–ò–°–¢–ï–ú–´ FPF BOT
# –°–æ–∑–¥–∞–Ω: {timestamp}
# –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞

# –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –°–ò–°–¢–ï–ú–´ FPF BOT  
# =============================================================================

## –û–ë–©–ê–Ø –ö–û–ù–¶–ï–ü–¶–ò–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–´

FPF Bot –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ **–º–æ–¥—É–ª—å–Ω–æ–π event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ** —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   DATA LAYER    ‚îÇ    ‚îÇ  LOGIC LAYER    ‚îÇ    ‚îÇ    UI LAYER     ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ  StreamCore     ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  FPFDetector    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  MainWindow     ‚îÇ
‚îÇ  LevelEngine    ‚îÇ    ‚îÇ  SignalManager  ‚îÇ    ‚îÇ  SignalsPanel   ‚îÇ
‚îÇ  DataFetcher    ‚îÇ    ‚îÇ  ContextFilters ‚îÇ    ‚îÇ  FiltersPanel   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ STORAGE LAYER   ‚îÇ    ‚îÇ  SERVICE LAYER  ‚îÇ    ‚îÇ INTEGRATION     ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ  Database       ‚îÇ    ‚îÇ  EventBus       ‚îÇ    ‚îÇ  TelegramBot    ‚îÇ
‚îÇ  FileStorage    ‚îÇ    ‚îÇ  TaskScheduler  ‚îÇ    ‚îÇ  TradingView    ‚îÇ
‚îÇ  CloudSync      ‚îÇ    ‚îÇ  ErrorHandler   ‚îÇ    ‚îÇ  BinanceAPI     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ü–†–ò–ù–¶–ò–ü–´ –ê–†–•–ò–¢–ï–ö–¢–£–†–´

### 1. EVENT-DRIVEN DESIGN
–í—Å—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è:
- `CandleClosedEvent` ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç –∞–Ω–∞–ª–∏–∑ —É—Ä–æ–≤–Ω–µ–π –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- `PatternDetectedEvent` ‚Üí –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é  
- `SignalGeneratedEvent` ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –ª–æ–≥–∏—Ä—É–µ—Ç

### 2. LOOSE COUPLING
–ú–æ–¥—É–ª–∏ –æ–±—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ EventBus:
```python
# –ú–æ–¥—É–ª—å A –Ω–µ –∑–Ω–∞–µ—Ç –æ –º–æ–¥—É–ª–µ B –Ω–∞–ø—Ä—è–º—É—é
event_bus.emit(PatternDetectedEvent(pattern_data))

# –ú–æ–¥—É–ª—å B –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ —Å–æ–±—ã—Ç–∏—è
@event_bus.subscribe(PatternDetectedEvent)
def handle_pattern(event):
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è
```

### 3. SINGLE RESPONSIBILITY
–ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –∏–º–µ–µ—Ç –æ–¥–Ω—É —á–µ—Ç–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é:
- **StreamCore**: –¢–æ–ª—å–∫–æ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **FPFDetector**: –¢–æ–ª—å–∫–æ –¥–µ—Ç–µ–∫—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- **ContextFilters**: –¢–æ–ª—å–∫–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
- **SignalManager**: –¢–æ–ª—å–∫–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–∏–≥–Ω–∞–ª–æ–≤

### 4. FAIL-SAFE OPERATION
–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø—Ä–∏ —Å–±–æ–µ –º–æ–¥—É–ª–µ–π:
```python
try:
    pattern = fpf_detector.detect_pattern(candles)
except Exception as e:
    logger.error(f"FPF detection failed: {e}")
    # –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –±–µ–∑ —ç—Ç–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞
    pattern = None
```

## –ü–û–î–†–û–ë–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ú–û–î–£–õ–ï–ô

### DATA LAYER - –°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö

#### StreamCore
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–í—Ö–æ–¥—ã**: Binance WebSocket/REST API
- **–í—ã—Ö–æ–¥—ã**: CandleClosedEvent –¥–ª—è –≤—Å–µ—Ö –¢–§
- **–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ê–≥—Ä–µ–≥–∞—Ü–∏—è M1 ‚Üí M5 ‚Üí M15 ‚Üí H1 ‚Üí H4
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –¥–µ—Ç–µ–∫—Ü–∏—è –ø—Ä–æ–ø—É—Å–∫–æ–≤
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ WS ‚Üî REST –ø—Ä–∏ —Å–±–æ—è—Ö

#### LevelEngine  
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –†–∞—Å—á–µ—Ç –∑–Ω–∞—á–∏–º—ã—Ö —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π
- **–í—Ö–æ–¥—ã**: CandleClosedEvent
- **–í—ã—Ö–æ–¥—ã**: LevelUpdatedEvent
- **–†–∞—Å—á–µ—Ç–Ω—ã–µ —É—Ä–æ–≤–Ω–∏**:
  - HOD/LOD (High/Low of Day)
  - POC (Point of Control) 
  - VWAP (Volume Weighted Average Price)
  - Swing —Ç–æ—á–∫–∏

### LOGIC LAYER - –°–ª–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

#### FPFDetector
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –î–µ—Ç–µ–∫—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ Fix-Prefix-Fix
- **State Machine**: 8 —Å–æ—Å—Ç–æ—è–Ω–∏–π –æ—Ç IDLE –¥–æ PATTERN_COMPLETE
- **–ê–ª–≥–æ—Ä–∏—Ç–º—ã**:
  - –ü–æ–∏—Å–∫ FIX –æ–±–ª–∞—Å—Ç–µ–π (–∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è)
  - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ RAY –ª–∏–Ω–∏–π (–≤–∞–ª–∏–¥–∞—Ü–∏—è)
  - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ PREFIX –∑–æ–Ω (–≤—Ö–æ–¥—ã)
  - –†–∞—Å—á–µ—Ç confidence score

#### ContextFilters
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
- **5 —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Å –≤–µ—Å–∞–º–∏**:
  - Volume (30%) - —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π
  - ATR (25%) - –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
  - Level (20%) - –±–ª–∏–∑–æ—Å—Ç—å –∫ —É—Ä–æ–≤–Ω—è–º
  - Session (15%) - —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏
  - Multi-TF (10%) - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å—Ç–∞—Ä—à–∏–º–∏ –¢–§

#### SignalManager
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–∏–≥–Ω–∞–ª–æ–≤
- **–§—É–Ω–∫—Ü–∏–∏**:
  - –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ —Å —Ä–∞–∑–Ω—ã—Ö –¢–§
  - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
  - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  - –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### SERVICE LAYER - –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π

#### EventBus
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —à–∏–Ω–∞ —Å–æ–±—ã—Ç–∏–π
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Å–æ–±—ã—Ç–∏–π
  - Batch processing –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  - Error handling –∏ retry –ª–æ–≥–∏–∫–∞

#### TaskScheduler
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
- **–ó–∞–¥–∞—á–∏**:
  - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ML –º–æ–¥–µ–ª–µ–π
  - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ API
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤

## –ü–û–¢–û–ö–ò –î–ê–ù–ù–´–•

### –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤:
```
Binance WS ‚Üí StreamCore ‚Üí CandleClosedEvent ‚Üí
LevelEngine ‚Üí LevelUpdatedEvent ‚Üí
FPFDetector ‚Üí PatternDetectedEvent ‚Üí  
ContextFilters ‚Üí SignalValidatedEvent ‚Üí
SignalManager ‚Üí SignalGeneratedEvent ‚Üí
UI + Telegram + Logging
```

### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ (–æ–±—É—á–µ–Ω–∏–µ):
```
SignalResult ‚Üí ML Pipeline ‚Üí Model Update ‚Üí
ContextFilters Parameter Adjustment ‚Üí
Improved Signal Quality
```

## –ú–ê–°–®–¢–ê–ë–ò–†–£–ï–ú–û–°–¢–¨

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –ö–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º
- EventBus –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ —Å–∏–º–≤–æ–ª–∞–º

### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –ú–æ–¥—É–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å
- Batch processing –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π —É—Ä–æ–≤–Ω–µ–π –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

## –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –ù–ê–î–ï–ñ–ù–û–°–¢–¨

### Error Handling:
- –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω try/catch –±–ª–æ–∫–∞–º–∏
- Graceful degradation –ø—Ä–∏ —Å–±–æ—è—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ retry –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API

### Data Integrity:
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –î–µ—Ç–µ–∫—Ü–∏—è –∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –ø—Ä–æ–ø—É—Å–∫–æ–≤
- Backup –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### Security:
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ API –∫–ª—é—á–µ–π
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ rate limits
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –ú–ï–¢–†–ò–ö–ò

### Performance Metrics:
- –ó–∞–¥–µ—Ä–∂–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU/RAM
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–∏–∫–æ–≤

### Business Metrics:
- Win rate —Å–∏–≥–Ω–∞–ª–æ–≤
- Profit factor
- Maximum drawdown
- Sharpe ratio

### System Health:
- –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ API
- –û—á–µ—Ä–µ–¥–∏ —Å–æ–±—ã—Ç–∏–π
- –û—à–∏–±–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

---

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø—Ä–∏ —Å–±–æ—è—Ö –º–æ–¥—É–ª–µ–π
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–∏  
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - event-driven –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** - –º–æ–¥—É–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω—ã –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Å–∏—Å—Ç–µ–º—É
‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ""".format(
            timestamp=datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        )
        
        file_path = self.baza_path / "03_architecture.txt"
        file_path.write_text(architecture_content)
        print("‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã: 03_architecture.txt")
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å
        self._update_index()
        
    def _update_index(self):
        """–û–±–Ω–æ–≤–ª—è–µ—Ç —Ñ–∞–π–ª –∏–Ω–¥–µ–∫—Å–∞"""
        index_path = self.baza_path / "00_INDEX.txt"
        if index_path.exists():
            content = index_path.read_text()
            
            # –î–æ–±–∞–≤–ª—è–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
            if "03_architecture.txt" not in content:
                updated_content = content.replace(
                    "- `02_philosophy.txt` - –§–∏–ª–æ—Å–æ—Ñ–∏—è –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞",
                    """- `02_philosophy.txt` - –§–∏–ª–æ—Å–æ—Ñ–∏—è –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- `03_architecture.txt` - –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã"""
                )
                
                # –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—É —Å–æ–∑–¥–∞–Ω–∏—è
                timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
                updated_content = updated_content.replace(
                    "# –°–æ–∑–¥–∞–Ω: 2025-08-29 19:03:09",
                    f"# –°–æ–∑–¥–∞–Ω: 2025-08-29 19:03:09\n# –û–±–Ω–æ–≤–ª–µ–Ω: {timestamp}"
                )
                
                index_path.write_text(updated_content)
                print("‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∏–Ω–¥–µ–∫—Å –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π")
                
    def sync_to_github(self, message=None):
        """–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å GitHub"""
        try:
            if message:
                subprocess.run([
                    "python3", "/Users/sashaflok/fpf_bot/sync_knowledge_base.py", message
                ], check=True)
            else:
                subprocess.run([
                    "python3", "/Users/sashaflok/fpf_bot/sync_knowledge_base.py"
                ], check=True)
        except subprocess.CalledProcessError as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å GitHub: {e}")


def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è CLI"""
    import sys
    
    manager = KnowledgeManager()
    
    if len(sys.argv) < 2:
        print("üìö –ú–µ–Ω–µ–¥–∂–µ—Ä –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π FPF Bot")
        print("‚ïê" * 40)
        print("–ö–æ–º–∞–Ω–¥—ã:")
        print("  universal    - –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç–∏ FPF")
        print("  architecture - –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã")
        print("  sync [msg]   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å GitHub")
        print("  update <section> <content> - –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª")
        print(f"\n–†–∞–∑–¥–µ–ª—ã: {', '.join(manager.sections.keys())}")
        return
        
    command = sys.argv[1]
    
    if command == "universal":
        manager.add_universal_fpf_info()
        manager.sync_to_github("üìà –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç–∏ FPF –ø–∞—Ç—Ç–µ—Ä–Ω–∞")
        
    elif command == "architecture":
        manager.create_architecture_file()
        manager.sync_to_github("üèóÔ∏è –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–∏—Å—Ç–µ–º—ã")
        
    elif command == "sync":
        message = " ".join(sys.argv[2:]) if len(sys.argv) > 2 else None
        manager.sync_to_github(message)
        
    elif command == "update" and len(sys.argv) >= 4:
        section = sys.argv[2]
        content = " ".join(sys.argv[3:])
        if manager.update_section(section, content):
            manager.sync_to_github(f"üìù –û–±–Ω–æ–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª {section}")
    else:
        print("‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤")


if __name__ == "__main__":
    main()