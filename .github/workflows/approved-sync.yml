name: 🎯 Approved Changes Sync

on:
  push:
    tags:
      - 'release/*'
      - 'stable/*'
      - 'production/*'
  workflow_dispatch:
    inputs:
      sync_type:
        description: 'Type of sync'
        required: true
        default: 'development'
        type: choice
        options:
        - development
        - testing
        - approved
        - production
      commit_message:
        description: 'Commit message for approved changes'
        required: true
        default: '📦 Approved update sync'

jobs:
  approved-sync:
    if: github.event.inputs.sync_type == 'approved' || github.event.inputs.sync_type == 'production' || startsWith(github.ref, 'refs/tags/release/') || startsWith(github.ref, 'refs/tags/stable/') || startsWith(github.ref, 'refs/tags/production/')
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: 🏷️ Tag Approved Release
      run: |
        echo "Creating approved release tag"
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        # Create approved release tag
        TIMESTAMP=$(date '+%Y%m%d_%H%M%S')
        TAG_NAME="approved/${TIMESTAMP}"
        
        git tag -a "${TAG_NAME}" -m "${{ github.event.inputs.commit_message || 'Automated approved sync' }}"
        git push origin "${TAG_NAME}"
    
    - name: ✅ Sync Approved Changes
      run: |
        echo "✅ Changes approved and synced to GitHub"
        echo "🏷️ Tagged as approved release"
        echo "📦 Ready for production use"